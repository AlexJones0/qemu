# OpenTitan configuration file

Some OpenTitan configuration parameters are sensitive enough to avoid storing them into the QEMU
source code nor the built QEMU binary.

Such configuration parameters are - but not limited to -:
* Keys
* Nonces
* Seeds
* Tokens
* ...

It is possible to load a selected list of configuration parameters from a QEMU configuration file
that the QEMU executable loads at startup, which enables to store those sensitive parameters into
a different location than the QEMU source code and executable.

This configuration file, whose syntax is loosely based on the INI file format, can be read with the
`-readconfig <file.cfg>` QEMU option.

Depending on the machine, the parameters may either override default constants defined in the source
code - such as default cryptographic constants that are already exposed in the public OpenTitan
repository - or be required in the configuration file for the matching device to become functional.

⚠️ Beware **not** to store such a configuration file into a public repository if it contains
   production data!

## Syntax

All sections in the configuration files should follow the following scheme:
`[ot_device "<device>[<.ot_id>"]`, where `<device>` is the mandatory OpenTitan device name, and
`<ot_id>` is an optional device instance identifier.

When no `<ot_id>` identifier is provided, the parameter within the sections are applied to all
instances of the selected device.

The separator between the `<device>` and the `<ot_id>` parameter should be a single dot `.`.

The remaning line of the section are (key, value) pairs, expressed as `<key> = <value>`. The `key`
is always a string which is one of the device's supported properties. The value may either be a
string, a unsigned 64-bit integer or boolean, which should match the type of the selected property.

### Example

```ini
[ot_device "ot_dev"]
a_string_prop = "abcde"
an_integer = 0x1234
a_boolean = true
```

## Generation

It is possible to delegate the generation of an OpenTitan configuration file to the [`cfggen.py`](cfggen.md)
script, using an existing OpenTitan repository.

## Configurable constants

Constants can usually be retrieved from the OpenTitan autogenerated "top" HSJON file, from the
`hw/<topname>/data/autogen/<topname>.gen.hjson` file.

### ROM controller [rom]

```ini
[ot_device "ot-rom_ctrl.<romid>"]
  # 128-bit key, match RndCnstRomCtrl*ScrKey
  key = "ffeeddccbbaa99887766554433221100"
  # 64-bit nonce, match RndCnstRomCtrl*ScrNonce
  nonce = "0123456789abcdef"
```
where `<romid>` is the ROM identifier as documented [here](rom_ctrl.md#romid)

### OTP controller [otp]

```ini
[ot_device "ot-otp-dj"]
  # 256-bit scramble key, match RndCnstOtpCtrlScrmblKeyInit
  scrmbl_key = "ffeeddccbbaa99887766554433221100ffeeddccbbaa99887766554433221100"
  # consistency digest
  digest_const = "ffeeddccbbaa99887766554433221100"
  digest_iv = "0123456789abcdef"
  # SRAM data key
  sram_const = "ffeeddccbbaa99887766554433221100"
  sram_iv = "0123456789abcdef"
  # 20-byte sequence of the first non-RAW life cycle state (LC_STATE_TESTUNLOCKED0)
  lc_state_first = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"
  # 20-byte sequence of the last valid life cycle state (LC_STATE_SCRAP)
  lc_state_last = "bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb"
  # 24-byte sequence for the first non-RAW transition count (#1)
  lc_trscnt_first = "cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc"
  # 24-byte sequence for the last transition count (#24)
  lc_trscnt_last = "dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd"
```

Here, `digest_const` is expected to match the `--constant` argument of the [otptool.py](otptool.md)
tool, whereas `digest_iv` is expected to match its `--iv` argument. Should those values differ,
OpenTitan OTP controller would fail to verify the OTP partition digests.

### Life-Cycle controller [lifecyle]

```ini
[ot_device "ot-lc_ctrl"]
  # 128-bit token
  raw_unlock_token = "ffeeddccbbaa99887766554433221100"
```
